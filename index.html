<!DOCTYPE html><!--HTML5 doctype-->
<html>
<head>
<title>Your New Application</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<style type="text/css">
    /* Prevent copy paste for all elements except text fields */
    *  { -webkit-user-select:none; -webkit-tap-highlight-color:rgba(255, 255, 255, 0); }
    input, textarea  { -webkit-user-select:text; }
    
</style>
<script src="http://debug-software.intel.com/target/target-script-min.js#6d877bc6-d1fa-4553-9f59-18d004864d64"></script>
<script src='cordova.js'></script>
<link rel="stylesheet" href="jquery.mobile-1.3.2.min.css" />
<script src="jquery-1.9.1.min.js"></script>
<script src="jquery.mobile-1.3.2.min.js"></script>
<script type="text/javascript">
var deviceIP;

/* This function runs once the page is loaded, but appMobi is not yet active */
var onWindowLoad = function(){

};
window.addEventListener("load", onWindowLoad, false);  

/* This code prevents users from dragging the page */
var preventDefaultScroll = function(event) {
    event.preventDefault();
    window.scroll(0,0);
    return false;
};
document.addEventListener('touchmove', preventDefaultScroll, false);

function sendButton(buttonName) {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
        if (this.readyState == 4 /* this.DONE */) {
            if (this.status == 200) {
                console.log('SENT!');
            }
        }
    };
    xhr.open("POST", "http://10.3.71.190:8060/keypress/" + buttonName);
    xhr.send();
}

function getApps() {
    console.log('GETTING APPS!!!');
    $.ajax({
        type: "GET",
        url: "http://10.3.71.198:8060/query/apps",
        dataType: "xml"
    }).done(function (xml) {
        // console.log('GOT A RESPONSE');
        $(xml).find('app').each(function (app) {
            var appName = $(this).text();
            var appId = $(this).attr('id');
            console.log('APP HERE' + $(this).attr('id'));
            var appImage = '<img src="http://10.3.71.198:8060/query/icon/' + appId + '"/>';
            $('#appsListView').append('<li><a>' + appImage + appName + '</a></li>');
        });
        $('#appsListView').listview('refresh');
    });
}

var onDeviceReady=function() {
    $('#connectButton').click(function () {
        deviceIP = $('device-ip').val();
        $.mobile.changePage($('#controlsPage'), { transition: 'slide' });
    });
    
    $("a[data-role=tab]").each(function () {
        var anchor = $(this);
        anchor.bind("click", function () {
            $.mobile.changePage(anchor.attr("href"), {
                transition: "none",
                changeHash: false
            });
            return false;
        });
    });
    
    $("div[data-role=page]").bind("pagebeforeshow", function (e, data) {
        $.mobile.silentScroll(0);
        $.mobile.changePage.defaults.transition = 'slide';
    });

    getApps();

    // FIXME: deviceIP from local settings!!!

    document.getElementById('backButton').addEventListener('click', sendButton.bind(null, 'Back'), false);
    document.getElementById('upButton').addEventListener('click', sendButton.bind(null, 'Up'), false);
    document.getElementById('downButton').addEventListener('click', sendButton.bind(null, 'Down'), false);
    document.getElementById('leftButton').addEventListener('click', sendButton.bind(null, 'Left'), false);
    document.getElementById('rightButton').addEventListener('click', sendButton.bind(null, 'Right'), false);
};
document.addEventListener("deviceready", onDeviceReady, false);

</script>

</head>
<body>
    <div data-role="page" id="mainPage">
    
        <div data-role="header">
            <h1>Roku Remote</h1>
        </div><!-- /header -->
    
        <div data-role="content">
            <p style="padding-top: 33%">Enter IP address of the Roku: </p>
            <input type="text" placeholder="IP" name="number" pattern="[0-9]*" id="device-ip" value="">
            <a id="connectButton" href="#" data-role="button" data-mini="true" data-inline="true" data-icon="check" data-theme="b">Connect</a>
        </div><!-- /content -->
    
        <div data-role="footer">
        </div><!-- /footer -->
    </div><!-- /page -->
    
    <div data-role="page" id="appsPage">
    
        <div data-role="header">
            <a href="#" data-icon="arrow-l" data-iconpos="left" data-rel="back" data-transition="slide" data-direction="reverse">Back</a>
            <h1>Roku Remote</h1>
               <div data-role="navbar">
                    <ul>
                        <li><a href="#appsPage" data-role="tab" data-icon="grid" class="ui-btn-active">Apps</a></li>
                        <li><a href="#controlsPage" data-role="tab" data-icon="grid">Controls</a></li>
                    </ul>
                </div>
        </div><!-- /header -->

        <div data-role="content">
            <ul data-role="listview" id="appsListView">
            </ul>
        </div><!-- /content -->
    
        <div data-role="footer">
        </div><!-- /footer -->
    </div><!-- /page -->

    <div data-role="page" id="controlsPage">
    
        <div data-role="header">
            <a href="#" data-icon="arrow-l" data-iconpos="left" data-rel="back" data-transition="slide" data-direction="reverse">Back</a>
            <h1>Roku Remote</h1>
               <div data-role="navbar">
                    <ul>
                        <li><a href="#appsPage" data-role="tab" data-icon="grid">Apps</a></li>
                        <li><a href="#controlsPage" data-role="tab" data-icon="grid" class="ui-btn-active">Controls</a></li>
                    </ul>
                </div>
        </div><!-- /header -->

        <div data-role="content">
            <p style="padding-top: 33%">Show the remote controls here</p>
       </div><!-- /content -->
    
        <div data-role="footer">
        </div><!-- /footer -->
    </div><!-- /page -->

</body>
</html>
